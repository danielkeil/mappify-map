<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Quick Start Guide Example</title>
    <meta charset="utf-8"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>


<body>
<div id="map1" style="width: 500px; height: 500px"></div>
<div id="map2" style="width: 500px; height: 500px"></div>

<script src="../bower_components/chance/chance.js"></script>
<script src="../bower_components/leaflet/dist/leaflet.js"></script>
<script src="../bower_components/lodash/dist/lodash.min.js"></script>

<script>

    var prototype = {

        mapWithLayer: null,
        mapDirect: null,

        setupMap: function (domNodeId) {
            return L.map(domNodeId).setView([0, 0], 1);
        },

        createMarkerTestData: function (numberOfMarkers) {
            var chance = new Chance();

            return Array.apply(null, new Array(numberOfMarkers)).map(function () {
                return [chance.latitude(), chance.longitude()];
            });

        },

        createMarkerFormDataAndAppendTo: function (markerDataSet, target) {
            var markers = [];

            markerDataSet.forEach(function (data) {
                var marker = L.marker(data);
                marker.addTo(target);
                markers.push(marker);
            })

            return markers;
        },

        profileRemoveMarkerAtOnce: function (map, markerLayer) {
            var t0 = performance.now();
            map.removeLayer(markerLayer);
            var t1 = performance.now();

            return (t1 - t0);
        },

        profileRemoveEachMarkerSeparately: function (map, markerStore) {
            var t0 = performance.now();
            markerStore.forEach(function (marker) {
                map.removeLayer(marker);
            });
            var t1 = performance.now();

            return (t1 - t0);
        },

        reset: function() {
            this.mapDirect.remove();
            this.mapWithLayer.remove();
        },

        run: function (numberOfMarker) {

            // setup test data
            var testData = this.createMarkerTestData(numberOfMarker);

            // prepare direct map
            this.mapDirect = this.setupMap('map1');
            var markerStore = this.createMarkerFormDataAndAppendTo(testData, this.mapDirect);

            // prepare map with layer
            this.mapWithLayer = this.setupMap('map2');
            var markerLayer = L.layerGroup();
            markerLayer.addTo(this.mapWithLayer);
            this.createMarkerFormDataAndAppendTo(testData, markerLayer);

            var result = {};

            result.numberOfMarker = numberOfMarker;
            result.separately = this.profileRemoveEachMarkerSeparately(this.mapDirect, markerStore)
            result.atOnce = this.profileRemoveMarkerAtOnce(this.mapWithLayer, markerLayer);

            this.reset();

            return result;
        }
    };

    var resultSet = [];

    var test = Object.create(prototype);

    var steps = _.range(25, 2025, 25);

    _.forEach(steps, function(numberOfMarker) {
        resultSet.push(test.run(numberOfMarker));
    });

    _.forEach(resultSet, function(element) {
        console.log(element);
    });

</script>
</body>
</html>